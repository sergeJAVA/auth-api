<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title id="title">–ì–∞–ª–µ—Ä–µ—è –∫–∞—Ä—Ç–∏–Ω–æ–∫</title>
  <style>
    * {
      box-sizing: border-box;
    }
    body {
      margin: 0;
      font-family: sans-serif;
      background: #f4f4f4;
    }

    .header {
      height: 60px;
      background: #fff;
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 0 20px;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
      position: fixed;
      width: 100%;
      top: 0;
      z-index: 10;
    }

    .logo {
      font-weight: bold;
      cursor: pointer;
    }

    .profile-icon {
      width: 40px;
      height: 40px;
      background: #bbb;
      border-radius: 50%;
      cursor: pointer;
    }

    .profile-dropdown {
      position: absolute;
      top: 60px;
      right: 20px;
      background: white;
      border-radius: 8px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
      display: none;
      flex-direction: column;
      min-width: 180px;
      z-index: 100;
    }

    .profile-dropdown button {
      padding: 10px 16px;
      background: none;
      border: none;
      text-align: left;
      width: 100%;
      cursor: pointer;
    }

    .sidebar {
      position: fixed;
      top: 60px;
      left: 0;
      width: 220px;
      height: calc(100% - 60px);
      background: #fff;
      box-shadow: 2px 0 10px rgba(0,0,0,0.05);
      transform: translateX(-100%);
      transition: transform 0.3s ease;
      padding-top: 20px;
      z-index: 9;
      display: flex;
      flex-direction: column;
      justify-content: space-between;
    }

    .sidebar.active {
      transform: translateX(0);
    }

    .sidebar button {
      display: block;
      width: 100%;
      border: none;
      background: none;
      padding: 15px 20px;
      text-align: left;
      cursor: pointer;
      font-size: 16px;
    }

    .main {
      margin-top: 80px;
      padding: 20px;
    }


    .menu-toggle {
      margin-bottom: 20px;
      background: #ddd;
      border: none;
      padding: 8px 16px;
      border-radius: 5px;
      cursor: pointer;
    }

    .sidebar-footer {
      border-top: 1px solid #eee;
      padding: 15px 20px;
    }

    .gallery {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(220px, 1fr));
      gap: 16px;
      margin-top: 20px;
    }

    .gallery img {
      width: 100%;
      height: auto;
      border-radius: 8px;
      object-fit: cover;
      box-shadow: 0 2px 6px rgba(0,0,0,0.1);
      transition: transform 0.2s ease;
    }

    .gallery img:hover {
      transform: scale(1.03);
    }
  </style>
</head>
<body>

<div class="header">
  <div class="logo" onclick="reloadPage()" id="homeBtn">üè† –ì–ª–∞–≤–Ω–∞—è</div>
  <div class="profile-icon" onclick="toggleProfileMenu()"></div>
  <div class="profile-dropdown" id="profileDropdown">
    <button id="profileBtn">üë§ –õ–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç</button>
    <button onclick="toggleLanguage()" id="langBtn">üåê –°–º–µ–Ω–∏—Ç—å —è–∑—ã–∫</button>
    <button id="logoutBtn">üö™ –í—ã–π—Ç–∏</button>
  </div>
</div>

<div class="sidebar" id="sidebar">
  <div>
    <button id="myImagesBtn">üñº –ú–æ–∏ –∫–∞—Ä—Ç–∏–Ω–∫–∏</button>
    <button id="likedBtn">‚ù§Ô∏è –ü–æ–Ω—Ä–∞–≤–∏–≤—à–∏–µ—Å—è</button>
  </div>
  <div class="sidebar-footer">
    <button onclick="toggleSidebar()" id="hideMenuBtn">‚¨ÖÔ∏è –°–∫—Ä—ã—Ç—å –º–µ–Ω—é</button>
  </div>
</div>

<div class="main">
  <button class="menu-toggle" onclick="toggleSidebar()" id="menuBtn">‚ò∞ –ú–µ–Ω—é</button>
  <h1 id="mainTitle" >–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ –≥–∞–ª–µ—Ä–µ—é!</h1>
  <div class="gallery" id="gallery">
    <!-- –ó–∞–≥–ª—É—à–∫–∏ ‚Äî –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –±–æ–ª—å—à–µ -->
    <img src="https://picsum.photos/300/200?random=1" alt="img1" />
    <img src="https://picsum.photos/200/300?random=2" alt="img2" />
    <img src="https://picsum.photos/400/300?random=3" alt="img3" />
    <img src="https://picsum.photos/300/400?random=4" alt="img4" />
    <img src="https://picsum.photos/350/250?random=5" alt="img5" />
    <img src="https://picsum.photos/250/350?random=6" alt="img6" />
  </div>
  <!-- –ó–¥–µ—Å—å –±—É–¥—É—Ç –∫–∞—Ä—Ç–∏–Ω–∫–∏ -->
</div>

<script>
  const sidebar = document.getElementById('sidebar');
  const profileDropdown = document.getElementById('profileDropdown');

  let currentLang = 'ru';

  const translations = {
    ru: {
      home: "üè† –ì–ª–∞–≤–Ω–∞—è",
      profile: "üë§ –õ–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç",
      language: "üåê –°–º–µ–Ω–∏—Ç—å —è–∑—ã–∫",
      logout: "üö™ –í—ã–π—Ç–∏",
      myImages: "üñº –ú–æ–∏ –∫–∞—Ä—Ç–∏–Ω–∫–∏",
      liked: "‚ù§Ô∏è –ü–æ–Ω—Ä–∞–≤–∏–≤—à–∏–µ—Å—è",
      menu: "–ú–µ–Ω—é",
      hideMenu: "‚¨ÖÔ∏è –°–∫—Ä—ã—Ç—å –º–µ–Ω—é",
      title: "–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ –≥–∞–ª–µ—Ä–µ—é!"
    },
    en: {
      home: "üè† Home",
      profile: "üë§ Profile",
      language: "üåê Change language",
      logout: "üö™ Logout",
      myImages: "üñº My Images",
      liked: "‚ù§Ô∏è Liked",
      menu: "Menu",
      hideMenu: "‚¨ÖÔ∏è Hide menu",
      title: "Welcome to the gallery!"
    }
  };

  function toggleLanguage() {
    currentLang = currentLang === 'ru' ? 'en' : 'ru';
    const t = translations[currentLang];
    localStorage.setItem('lang', currentLang); // —Å–æ—Ö—Ä–∞–Ω—è–µ–º —è–∑—ã–∫

    document.getElementById('menuBtn').textContent = t.menu;
    document.getElementById('homeBtn').textContent = t.home;
    document.getElementById('profileBtn').textContent = t.profile;
    document.getElementById('langBtn').textContent = t.language;
    document.getElementById('logoutBtn').textContent = t.logout;
    document.getElementById('myImagesBtn').textContent = t.myImages;
    document.getElementById('likedBtn').textContent = t.liked;
    document.getElementById('hideMenuBtn').textContent = t.hideMenu;
    document.getElementById('mainTitle').textContent = t.title;
  }

  function toggleSidebar() {
    sidebar.classList.toggle('active');
  }

  function toggleProfileMenu() {
    profileDropdown.style.display = profileDropdown.style.display === 'flex' ? 'none' : 'flex';
  }

  function reloadPage() {
    window.location.reload();
  }

  document.addEventListener('click', function(e) {
    if (!e.target.closest('.profile-icon') && !e.target.closest('#profileDropdown')) {
      profileDropdown.style.display = 'none';
    }
  });

  // –í—ã—Ö–æ–¥ –∏–∑ –∞–∫–∫–∞—É–Ω—Ç–∞
  document.getElementById('logoutBtn').onclick = async function () {
    try {
      const response = await fetch('http://localhost:8081/auth/logout', {
        method: 'POST',
        credentials: 'include' // –û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ, —á—Ç–æ–±—ã –∫—É–∫–∏ –æ—Ç–ø—Ä–∞–≤–∏–ª–∏—Å—å
      });

      if (response.ok) {
        // –ü–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–≥–æ logout –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª—è–µ–º –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É –ª–æ–≥–∏–Ω–∞
        window.location.href = 'login.html';
      } else {
        alert('–ù–µ —É–¥–∞–ª–æ—Å—å –≤—ã–π—Ç–∏ –∏–∑ –∞–∫–∫–∞—É–Ω—Ç–∞ üòï');
      }
    } catch (error) {
      console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –≤—ã—Ö–æ–¥–µ:', error);
      alert('–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ –≤—ã—Ö–æ–¥–µ üòï');
    }
  };

  // üî• –ó–∞–≥—Ä—É–∂–∞–µ–º —Ä–µ–∞–ª—å–Ω—ã–µ –∫–∞—Ä—Ç–∏–Ω–∫–∏ –∏–∑ API
  async function fetchGalleryImages() {
    const gallery = document.getElementById('gallery');
    gallery.innerHTML = ''; // –æ—á–∏—â–∞–µ–º —Å—Ç–∞—Ä—ã–µ –∑–∞–≥–ª—É—à–∫–∏

    try {
      // –ü–æ–ª—É—á–∞–µ–º –≤—Å–µ –ø–æ—Å—Ç—ã
      const postsResponse = await fetch('http://localhost:8082/post/all-posts', {
        credentials: 'include',
      });
      const posts = await postsResponse.json();

      for (const post of posts) {
        try {
          // –ü–æ–ª—É—á–∞–µ–º –∫–∞—Ä—Ç–∏–Ω–∫—É –ø–æ title
          const imageRes = await fetch(`http://localhost:8086/image/download/${post.title}/${post.id}`, {
            credentials: 'include',
          });

          const imageBlob = await imageRes.blob();
          const imageUrl = URL.createObjectURL(imageBlob);

          // –°–æ–∑–¥–∞–µ–º –∏ –¥–æ–±–∞–≤–ª—è–µ–º –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ
          const img = document.createElement('img');
          img.src = imageUrl;
          img.alt = post.title;
          img.style.cursor = 'pointer';

          // –ü–µ—Ä–µ—Ö–æ–¥ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É –ø–æ—Å—Ç–∞ –ø–æ id
          img.onclick = () => {
            window.location.href = `post.html?id=${post.id}`;
          };

          gallery.appendChild(img);

        } catch (imageError) {
          console.warn(`–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –¥–ª—è –ø–æ—Å—Ç–∞ "${post.title}"`, imageError);
        }
      }

    } catch (err) {
      console.error("–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π:", err);
      gallery.innerHTML = '<p>–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è.</p>';
    }
  }

  // –ó–∞–≥—Ä—É–∂–∞–µ–º –∫–∞—Ä—Ç–∏–Ω–∫–∏ –ø–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏ DOM
  document.addEventListener("DOMContentLoaded", fetchGalleryImages);
</script>
</body>
</html>